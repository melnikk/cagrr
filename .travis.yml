language: go
go:
- 1.6
- tip
notifications:
  webhooks:
    urls:
    - https://webhooks.gitter.im/e/a85da9d6e9900584075a
    on_success: change
    on_failure: always
    on_start: never
before_install:
- sudo apt-get install -y rpm
- sudo apt-get install ruby-dev gcc make
- gem install fpm
- go get github.com/axw/gocov/gocov
- go get github.com/mattn/goveralls
- go get golang.org/x/tools/cmd/cover
- go get github.com/modocache/gover
- go get github.com/golang/lint/golint
- go get github.com/onsi/ginkgo/ginkgo
- go get github.com/onsi/gomega
- go get github.com/sohlich/elogrus
- go get github.com/Sirupsen/logrus
- go get gopkg.in/olivere/elastic.v3
- go get github.com/cyberdelia/go-metrics-graphite
- go get github.com/rcrowley/go-metrics
- go get github.com/melnikk/go_jolokia
- go get github.com/lytics/gowrapmx4j
- go get github.com/gocql/gocql
- go get golang.org/x/net/context
- go get github.com/jessevdk/go-flags
- go get github.com/gliderlabs/logspout
- go get github.com/looplab/logspout-logstash
install:
- make test
script:
- make packages
before_deploy:
- export RELEASE_PKG_TAR=$(ls build/cagrr*.tar.gz)
- export RELEASE_PKG_RPM=$(ls build/cagrr*.rpm)
- export RELEASE_PKG_DEB=$(ls build/cagrr*.deb)
deploy:
  provider: releases
  api_key:
    secure: IjaK7AABiiOt2PehU66dROBpyNUWrYQAXnxe0houOa8nuesbX41SAZl1xHpjeHQDzg4/26S8A+Dmiwy0L+ExBoIkRbEOR3ZoZYgzpEKDlGstGCc+yp6bgXXKEWcVofaB5fcTFim9N/G/mWqNvEezWayLnTVkzgDObNBY1XCSooEBfZqTD1FKWUZVstI30HdvGFBpcp+rUqbhtQnEnHO4CSYtXszTBM1yN7M7CoptckTNFei79t+B3Wf0vEjEAcysX7OXsWykGmj8sBT3Jz3ocMLeGfzrP+IGaImUuQgaixgZJiBpzLtQaVCyAm/hbRxu+hx2Y3RjC+vo5Gd86pwu9ddS5XhOsdWH7Hz34ljEZQiHg2JgB4sbuNWXWM/Ryce6BRcM4SjN6gEMwKP3iUlaclSlXyJNGEgbrRgwNSeZKjDqVuOFEQIB4H98+66nLMMyv7IwA97SRs8QRrCPyIoqrBZfENQnGYxhLRvf+t1XQjgjYmvrGEXEiSKlkFvNGd7Hb1F34lamoi534nN0OBpQl0qZ3koTtnWBnHumpa5bM0R/oq4qAQ8ysqYJ7d/9WdWZpLJOiEjqmCJTYyTCG8f9Sz8XuqEv3wiBO11fXlB0OD5R9sevTs6o2QfSSib8QV37WG8ntvEE7e7b8NVTOdo67IXMTaOPvRkmCXp+HsDxRjY=
  file:
    - "${RELEASE_PKG_TAR}"
    - "${RELEASE_PKG_DEB}"
    - "${RELEASE_PKG_RPM}"
  skip_cleanup: true
  on:
    tags: true
    repo: melnikk/cagrr
